# SpringMirai中配版开发教程

> 目前项目各功能都在开发中，因此暂不提供jar包，建议从git上clone或下载下来，
> 直接在本项目基础上开发。
> 开发请看主函数和demo包下的例子

> 本项目基于Spring Ioc容器，实现高度可定制、可扩展性。
> 
> 本项目理念：万物皆可自定义（几乎没有写死的功能）。
> 
> 因此，开发者可以使用内部默认实现来开发，当某功能不满足要求时，可自定义该功能。

## 目录
1. [基于内置默认功能开发](#基于内置默认功能开发)
    1. [控制器](#控制器)
    2. [控制器方法](#控制器方法)
    3. [路径映射](#路径映射)
    4. [过滤器](#过滤器)
    5. [控制器方法参数](#控制器方法参数)
    6. [控制器方法返回值](#控制器方法返回值)
2. [自定义](#自定义)
    1. [项目bean介绍](#项目bean介绍)
    2. [自定义唯一bean](#自定义唯一bean)
    3. [扩展排序bean](#扩展排序bean)
    4. [自定义排序bean](#自定义排序bean)

## 基于内置默认功能开发
> 内置默认功能都是基于注解、反射的方式实现的，使用者只需要了解注解的功能，不必了解实现细节
### 控制器
> 控制器是有`org.springframework.stereotype.Controller`注解的类。
> 
> 项目以控制器类作为加载的最小单位。
>
> 由于路径映射被设定为必需注解，
> 因此控制器类必须添加`com.lc.spring_mirai.annotation.RequestMapped`注解，
> 此注解复合了`@Controller`注解，因此可以不写`@Controller`注解
> 
> 示例：
> ```kotlin
> @Controller
> @RequestMapped
> class DemoController{
>     //代码......
> }
> ```
[回到目录](#目录)

### 控制器方法
> 控制器方法是控制器内部有`@RequestMapped`注解的方法。
> 
> 每一个控制器方法都会单独创建一个mirai事件监听。
> 
> 因此控制器方法可以看做`eventChannel.subscribeAlways{}`里面的内容

[回到目录](#目录)

### 路径映射
> 路径映射是`@RequestMapped`注解的值`value`，用于映射消息内容。
> 
> 因此非`MessageEvent`则不需要给注解设置值（但仍需要注解本身）。
> 
> `@RequestMapped`注解的值默认以`/`分割，文本消息默认以空格分割，
> 非文本消息每个单独占1层路径，不进一步分割。
> 
> `@RequestMapped`注解的每一层路径有以下几种内置类型(定义在`controller/mapped`包下)：
> 1. 通用型（不好用，不做介绍，有可能被弃用）
> 2. 绑定参数的路径，格式: {参数名}或{从0开始的参数位置}
> 3. 正则表达式，格式: [正则表达式] 注意反斜杠需要转义
> 4. 文本，格式：文本 需要消息匹配项与之完全相等
> 
> 如果需要扩展其他路径映射类型，可以参考教程目录第2章

[回到目录](#目录)

### 过滤器
> 过滤器是对事件通道进行过滤的，内置过滤器都是基于注解的。
> 
> 过滤器最终被组装成`eventChannel.filter{}`里面的内容。
> 
> 以下是几种内置过滤器(注解功能在`controller/filter`包里面实现):
> 1. `@EventFilter` 事件过滤，可以指定接收的事件类型
> 2. `@GroupFilter` 群过滤，可以指定包含的群号或忽略的群号（后期可能会调整成以before拦截器实现，方便运行时动态设置群过滤，并持久化）
> 3. `@PermissionFilter` 权限过滤，正在开发中

[回到目录](#目录)

### 控制器方法参数
> 控制器方法参数是方法获取数据的主要渠道之一。
> 
> 以下是几种内置的控制器方法参数(定义在`invoke/inject`包下):
> 1. 路径绑定参数，参数名需要与注解那里设置的保持一致。详见[路径映射](#路径映射)
> 2. 直接注入的参数，包含Spring的bean，Mirai的event、message、bot、group、user等等，见[参数注入源码](/src/main/kotlin/com/lc/spring_mirai/invoke/inject/SpringMiraiInject.kt)

[回到目录](#目录)

### 控制器方法返回值
> 控制器返回值一般在after后置拦截器里面处理。
> 
> 以下是将方法返回值作为消息发送出去的拦截器：
> [回消息拦截器](/src/main/kotlin/com/lc/spring_mirai/invoke/after/ReplyAfterHandle.kt)
> 
[回到目录](#目录)


## 自定义
### 项目bean介绍

[回到目录](#目录)

### 自定义唯一bean

[回到目录](#目录)

### 扩展排序bean

[回到目录](#目录)

### 自定义排序bean

[回到目录](#目录)