<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>机器人管理</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="//unpkg.com/layui@2.6.4/dist/css/layui.css">
  <script src="//unpkg.com/layui@2.6.4/dist/layui.js"></script>
  <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="/js/url.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="/js/main.js"></script>

</head>

<body>
<div id="app">
  <el-form :inline="true" :model="loginBot" class="demo-form-inline">
    <el-form-item label="账号">
      <el-input v-model="loginBot.qqId" placeholder="账号"></el-input>
    </el-form-item>
    <el-form-item label="密码">
      <el-input v-model="loginBot.password" placeholder="密码" type="password"></el-input>
    </el-form-item>
    <el-form-item label="登录协议">
      <el-select v-model="loginBot.protocol" placeholder="登录协议">
        <el-option label="安卓手机" value="ANDROID_PHONE"></el-option>
        <el-option label="安卓平板" value="ANDROID_PAD"></el-option>
        <el-option label="安卓手机" value="ANDROID_WATCH"></el-option>
      </el-select>
    </el-form-item>
    <el-form-item label="设备文件">
      <el-input v-model="loginBot.deviceFile" type="file"></el-input>
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="loginNewBot">登录</el-button>
    </el-form-item>
  </el-form>
  <el-table border stripe :data="bots" v-loading="loading">
    <el-table-column type="selection"></el-table-column>
    <el-table-column prop="qqId" label="账号" sortable></el-table-column>
    <el-table-column prop="nickName" label="昵称" sortable></el-table-column>
    <el-table-column prop="image" label="头像" sortable>
      <template slot-scope="scope">
        <img v-bind:src="scope.row.image" class="layui-nav-img">
      </template>
    </el-table-column>
    <el-table-column prop="online" label="是否在线" sortable>
      <template slot-scope="scope">
        <el-switch v-model="scope.row.online" @change="login(scope.row.qqId, scope.row.online)">
        </el-switch>
      </template>
    </el-table-column>
    <el-table-column label="操作">
      <template slot-scope="scope">
        <el-button v-on:click="botManager(scope.row)">管理</el-button>
      </template>
    </el-table-column>
  </el-table>
</div>

<script>

  let vue = new Vue({
    el: "#app",
    data: {
      bots: [
      ],
      loginBot: {

      }
    },
    methods: {
      login: function (qqId, online) {
        axios.get("/bot/login?online=" + online + "&qqId=" + qqId)
                .then(resp => {
                  if (online) {
                    this.$message({ message: "成功登录此账号", type: "success" });
                  } else {
                    this.$message("成功下线此账号");
                  }
                })
      },
      // 从后台更新表格数据
      getData: function (fn) {
        axios.get("/bot/bots")
                .then(resp => fn(resp.data))
                .catch(function (e) {
                  this.$message.error("刷新表格失败")
                })
      },
      botManager(row) {
        this.$message("机器人暂不提供管理功能")
      }
    },
    created: function () {
      this.loading = true;
      this.getData(data => this.bots = data);
      this.loading = false;
      //this.openDialog();
    }
  });
</script>
</body>

</html>